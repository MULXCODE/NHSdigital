
# Collapse types with only one property

SELECT  ?s ?sps ?spsP ?spsO ?spsp ?spsc  ?spscps ?spscpsp ?spscpso ?spscd
WHERE {
     FILTER(?spscpsn =1) .
     ?spscps ?spscpsp ?spscpso  .
  {
    SELECT ?s ?sps ?spsP ?spsO ?spsp ?spsc ?spscps ?spscd  (COUNT(?spscps) AS ?spscpsn) 
    WHERE 
    {
     ?s  a sh:NodeShape .
     FILTER(afn:namespace(?s) = "http://hl7.org/fhir#") .
     ?s sh:property ?sps .
     ?sps sh:path ?spsp .
     ?sps ?spsP ?spsO .
     ?sps sh:class ?spsc .
     ?spsc sh:property ?spscps .
     ?spsc <http://purl.org/dc/elements/1.1/description> ?spscd . 
   } GROUP BY ?s ?sps ?spsP ?spsO ?spsp ?spsc ?spscps ?spscd
  }
}



DELETE {
 ?sps ?spsP ?spsO .
}
INSERT {
  ?sps ?spscpsp ?spscpso .
  ?sps sh:description ?spscd .
} 
WHERE {
     FILTER(?spscpsn =1) .
     ?spscps ?spscpsp ?spscpso  .
  {
    SELECT ?s ?sps ?spsP ?spsO ?spsp ?spsc ?spscps ?spscd  (COUNT(?spscps) AS ?spscpsn) 
    WHERE 
    {
     ?s  a sh:NodeShape .
     FILTER(afn:namespace(?s) = "http://hl7.org/fhir#") .
     ?s sh:property ?sps .
     ?sps sh:path ?spsp .
     ?sps ?spsP ?spsO .
     ?sps sh:class ?spsc .
     ?spsc sh:property ?spscps .
     ?spsc <http://purl.org/dc/elements/1.1/description> ?spscd . 
   } GROUP BY ?s ?sps ?spsP ?spsO ?spsp ?spsc ?spscps ?spscd
  }
}


